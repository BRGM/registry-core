 <div class="row space-above">
  <div class="span12">
    #parse("breadcrumbs.vm")
  </div>
 </div>

 <div class="row">
  <div class="span8">
    <h1>Register: $node.name</h1>
    <p>
    #if($node.getPropertyValue("dct:description"))
      $node.getPropertyValue("dct:description").lexicalForm
    #else
      <em>no description supplied</em>
    #end
    </p>

    <ul class="nav nav-tabs nav-compact action-tab">
      <li class="active"><a href="#list" data-toggle="tab">List</a></li>
      <li><a href="#table" data-toggle="tab">Table</a></li>
      <li><a href="#administer" data-toggle="tab">Administer</a></li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane active" id="list">
      #set($items = $model.querySelectW("SELECT * where {?page a ldp:Page; api:items ?items.}"))
      #if (!$items.isEmpty())
        #set($members=$items.get(0).items.asList())
        #if(!$members.isEmpty())

        ## Pick out subregisters separately
          #if($node.getPropertyValue("reg:subregister"))
            <h3>Sub-registers</h3>
            #foreach($member in $members)
              #set($item=$member.connectedNodes("^reg:entity/^reg:definition").get(0))
              #if($item.hasResourceValue("reg:itemClass", "reg:Register"))
              <div class="result-blob">
                <div class="row">
                  <div class="span6">
                    <div class="blob-inner">
                        <strong>Register:</strong> #linkfor($member)
                        #if($member.getPropertyValue("dct:description"))
                          <p>$member.getPropertyValue("dct:description").lexicalForm</p>
                        #end
                    </div>
                  </div>
                  <div class="span1 pull-right">
                    #showstatus($item.getPropertyValue("reg:status"))
                  </div>
                </div>
              </div>
              #end
            #end
          #end

          ## now the members
          #set($started=false)
          #foreach($member in $members)
            #set($item=$member.connectedNodes("^reg:entity/^reg:definition").get(0))
            #if(!$item.hasResourceValue("reg:itemClass", "reg:Register"))
              #if(!$started)
                #set($started=true)
                <h3>Members</h3>
              #end
              <div class="result-blob">
                <div class="row">
                  <div class="span6">
                    <div class="blob-inner">
                      <strong>Item:</strong> <a href="#linkhref($item)">$item.getPropertyValue("reg:notation").lexicalForm</a> ("$item.name")
                      <p><strong>Type:</strong> #foreach($ty in $item.listPropertyValues("reg:itemClass"))#linkfor($ty)#if( $foreach.hasNext ), #end#end </p>
                      #if($item.getPropertyValue("dct:description"))
                        <p>$item.getPropertyValue("dct:description").lexicalForm</p>
                      #end
                    </div>
                  </div>
                  <div class="span1 pull-right">
                    #showstatus($item.getPropertyValue("reg:status"))
                  </div>
                </div>
              </div>
            #end
          #end
        #end
      #end
      </div>
      <div class="tab-pane" id="table" data-action="register-table">
        <p>To be implemented.</p>
      </div>
      <div class="tab-pane" id="administer">
        <p>To be implemented.</p>
      </div>
    </div>
  </div>

  <div class="span4">
    #set($entity=$node)
    #parse("formats.vm")

     <div class="panel">
       <div class="panel-head">
         <h4>Register definition</h4>
       </div>
       <div class="panel-body">
         #restable($node, "table-striped table-condensed")
      </div>
     </div>

  </div>

</div>
