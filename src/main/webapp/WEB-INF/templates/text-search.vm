#set($pageTitle="Search: $query")
#parse("header.vm")
#parse("navbar.vm")

#set($target='<nullsearch>')
#if($query && !$query.trim().isEmpty()) #set($target=$query) #end

#set($response=$registry.perform("Search","?query=$lib.pathEncode($query)&_view=with_metadata"))

#if($response.status == 200)
  #set($model=$response.entity)
  #set($items=$model.querySelectW("SELECT * WHERE {?page a ldp:Page; api:items ?items}").get(0).items.asList())

  <h3>Search results for: $query</h3>

  <div class="row">
    <div class="span8">
        #foreach($entity in $items)
          #set($temp=$entity.connectedNodes("^reg:entity/^reg:definition"))
          #if(!$temp.isEmpty())  #set($item=$temp.get(0)) #else #set($item=$entity) #end

          <div class="result-blob">
            <div class="row">
              <div class="span6">
                <div class="blob-inner">
                    <strong>Entity:</strong> <a href="#linkhref($entity)"> $entity.name </a>
                    <p><strong>Type:</strong> #foreach($ty in $entity.listPropertyValues("rdf:type"))#linkfor($ty)#if( $foreach.hasNext ), #end#end </p>
                    #if($item.getPropertyValue("dct:description"))
                      <p>$item.getPropertyValue("dct:description").lexicalForm</p>
                    #end
                </div>
              </div>
              #if ($item.getPropertyValue("reg:status"))
              <div class="span1 pull-right">
                #showstatus($item.getPropertyValue("reg:status"))
              </div>
              #end
            </div>
          </div>
        #end
    </div>

    <div class="span4">
      <div class="label label-info">
        <h4>Facet browsing support goes here</h4>
      </div>

    </div>
  </div>

#else
  #parse("internal-error.vm")
#end


#include("footer.vm")
